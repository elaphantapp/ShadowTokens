npm run deploy

> deploy@1.0.0 deploy /Users/zhouhe/blockchain/poanetwork/tokenbridge-contracts/deploy
> if test "$NOFLAT" != "true" ; then cd ..; npm run flatten; cd deploy; fi && node deploy.js


> tokenbridge-contracts@5.4.1 flatten /Users/zhouhe/blockchain/poanetwork/tokenbridge-contracts
> bash flatten.sh

Flattening common bridge contracts
Flattening bridge validators contracts
Flattening contracts related to native-to-erc bridge
Flattening contracts related to erc-to-erc bridge
Flattening contracts related to erc-to-native bridge
Flattening contracts related to arbitrary-message bridge
Flattening contracts related to erc677 to erc677 on top of AMB bridge
Flattening contracts related to stake token mediators
Flattening contracts related to native-to-erc on top of AMB bridge
Flattening contracts related to erc-to-native on top of AMB bridge
Flattening contracts related to multi-erc-to-erc on top of AMB bridge
Bridge mode: ARBITRARY_MESSAGE
========================================
Deploying Arbitrary Message Bridge at Home
========================================

deploying storage for home validators
pending txHash 0x6bd1101d9b5dae6ae1b3f87aa2f070f0e64d5a67d14920bf452bc82c7b03e51a
It was not possible to verify 0x0ec971b50e6a172e3754e2459a939394c91cb8ef in blockscout
[Home] BridgeValidators Storage:  0x0EC971b50e6A172e3754E2459a939394c91Cb8Ef

deploying implementation for home validators
pending txHash 0x2230cafdf551d919efbbcaa9062605ed686d5b67cc8d631a7f6f20003c2e08eb
It was not possible to verify 0xd5b4f8a146d4225f4eb29925ab19e4f239295336 in blockscout
[Home] BridgeValidators Implementation:  0xD5b4f8a146d4225F4EB29925AB19E4F239295336

hooking up eternal storage to BridgeValidators
sendRawTxHome ===> 
pending txHash 0xec25f18b48b5a5ae7f4b0df924225cc3acc6cbd43acde8484c83529d6c546889

initializing Home Bridge Validators with following parameters:

REQUIRED_NUMBER_OF_VALIDATORS: 1, VALIDATORS: 0x4456D699Fb0b98350A910B912c6fA035148b1b6F, VALIDATORS_OWNER: 0xcdbb781AC508B19c126646E9aEDF1475144c0262
initializeValidators ===> 111111
initializeValidators ===> 222222
sendRawTxHome ===> 
pending txHash 0xe7fe140c7bb10ae3e96a0a091858c089df5f7dc87565f8c61844b21a291eb277
initializeValidators ===> 333333
initializeValidators ===>, {"blockHash":"0xb5123c0ad83fd972f36d01bbb47f6ca79e1371ab84be309ed1428566b89e6ca8","blockNumber":"0x107b069","contractAddress":null,"cumulativeGasUsed":"0x5611c","from":"0x50fe4ae09765962dd7d9af89e640277e34bc1743","gasUsed":"0x2d23d","logs":[{"address":"0x0ec971b50e6a172e3754e2459a939394c91cb8ef","blockHash":"0xb5123c0ad83fd972f36d01bbb47f6ca79e1371ab84be309ed1428566b89e6ca8","blockNumber":"0x107b069","data":"0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cdbb781ac508b19c126646e9aedf1475144c0262","logIndex":"0x0","removed":false,"topics":["0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0"],"transactionHash":"0xe7fe140c7bb10ae3e96a0a091858c089df5f7dc87565f8c61844b21a291eb277","transactionIndex":"0x1","transactionLogIndex":"0x0","type":"mined"},{"address":"0x0ec971b50e6a172e3754e2459a939394c91cb8ef","blockHash":"0xb5123c0ad83fd972f36d01bbb47f6ca79e1371ab84be309ed1428566b89e6ca8","blockNumber":"0x107b069","data":"0x","logIndex":"0x1","removed":false,"topics":["0xe366c1c0452ed8eec96861e9e54141ebff23c9ec89fe27b996b45f5ec3884987","0x0000000000000000000000004456d699fb0b98350a910b912c6fa035148b1b6f"],"transactionHash":"0xe7fe140c7bb10ae3e96a0a091858c089df5f7dc87565f8c61844b21a291eb277","transactionIndex":"0x1","transactionLogIndex":"0x1","type":"mined"},{"address":"0x0ec971b50e6a172e3754e2459a939394c91cb8ef","blockHash":"0xb5123c0ad83fd972f36d01bbb47f6ca79e1371ab84be309ed1428566b89e6ca8","blockNumber":"0x107b069","data":"0x0000000000000000000000000000000000000000000000000000000000000001","logIndex":"0x2","removed":false,"topics":["0x10dbc913050d3180c3b99f7da91fd514af7cbc9c1bb59a0da5d2bc38f0cf395a"],"transactionHash":"0xe7fe140c7bb10ae3e96a0a091858c089df5f7dc87565f8c61844b21a291eb277","transactionIndex":"0x1","transactionLogIndex":"0x2","type":"mined"}],"logsBloom":"0x00000000000020000000000000000000000000000000000000800000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000400000000000000000000000000000000000000000000200000000000000000000080000000000000000000000000020000000000000000000000000000000000020000000000000000000000000000001000000000000400000000000000000000000000000000000000000000000000000000040000008400000000000000000","status":"0x1","to":"0x0ec971b50e6a172e3754e2459a939394c91cb8ef","transactionHash":"0xe7fe140c7bb10ae3e96a0a091858c089df5f7dc87565f8c61844b21a291eb277","transactionIndex":"0x1"}
initializeValidators ===> 444444
transferring proxy ownership to multisig for Validators Proxy contract
sendRawTxHome ===> 
pending txHash 0xaf71fdc99651666328785f9919a38d21267a01a2b77f4d98aeca6d14874b1f05

deploying HomeAMBridge storage

pending txHash 0x2407be7140cf45514dc6731fefcfcc7593a656b0b93acb8ad6f5b90fc81a4eef
It was not possible to verify 0x475a7c9b943f278a1b45287d600d39a186c19698 in blockscout
[Home] HomeAMBridge Storage:  0x475A7C9B943F278A1b45287d600D39A186c19698

deploying HomeAMBridge implementation

pending txHash 0xa1e1dc811689544aa6a56d10cb0f0fac0237373d31690c96568c6112a101615b
It was not possible to verify 0x622f2b7bf93fce96c0b8d5b2f5724dd64a81c5bc in blockscout
[Home] HomeAMBridge Implementation:  0x622f2B7Bf93FcE96c0b8D5b2f5724dd64A81C5Bc

hooking up HomeAMBridge storage to HomeAMBridge implementation
sendRawTxHome ===> 
pending txHash 0xd9cf8ef0d96877d50a0e9b627e1fedf9550115db9982da4fec820710c36cf3af

initializing Home Bridge with following parameters:

SOURCE_CHAIN_ID: 77, DESTINATION_CHAIN_ID: 42, Home Validators: 0x0EC971b50e6A172e3754E2459a939394c91Cb8Ef,
  HOME_MAX_AMOUNT_PER_TX (gas limit per call): 1500000000000000000000000,
  HOME_GAS_PRICE: 1000000000, HOME_REQUIRED_BLOCK_CONFIRMATIONS : 1
  
sendRawTxHome ===> 
pending txHash 0xd506038e184d3973f32cd756c6ea970f9a8192e60e700078e0e9b3228c84ef30
transferring proxy ownership to multisig for Home bridge Proxy contract
sendRawTxHome ===> 
pending txHash 0x136bdcaabdfc2296ed612ff6c71766bf40fa7be1ebb5f3793b0645f7c154af72

Deployment of Arbitrary Message Bridge at Home completed

========================================
Deploying Arbitrary Message Bridge at Foreign
========================================

deploying storage for foreign validators
pending txHash 0x0ed2a86895a3bbcf6eac30a0107dd73455452e05933853f806302aefbbe1046e
It was not possible to verify 0x822764f7780df2e361640c1f0a5ee44b9e669f18 in etherscan
[Foreign] BridgeValidators Storage:  0x822764f7780df2E361640C1f0A5Ee44b9e669f18

deploying implementation for foreign validators
pending txHash 0xb2605a5724b787ac7a9a364caa639a133d32f64d079e6289f5bf52e8e614a9a4
It was not possible to verify 0xbf5b3ae727667f76f023eae2607ec475de5d0c8a in etherscan
[Foreign] BridgeValidators Implementation:  0xbF5b3Ae727667f76F023eAE2607ec475DE5d0c8A

hooking up eternal storage to BridgeValidators
pending txHash 0x917cd33e57afc9455a9a058d5c2eb6c60299bc21c0182015c2a4ffa385315167

initializing Foreign Bridge Validators with following parameters:

REQUIRED_NUMBER_OF_VALIDATORS: 1, VALIDATORS: 0x4456D699Fb0b98350A910B912c6fA035148b1b6F, VALIDATORS_OWNER: 0xcdbb781AC508B19c126646E9aEDF1475144c0262
initializeValidators ===> 111111
initializeValidators ===> 222222
pending txHash 0xed8d1aa27390aafcc68574cef2bbeb8424834020c46da8bd9e5dccc13a5f07d1
initializeValidators ===> 333333
initializeValidators ===>, {"blockHash":"0x5a90b313806798406ac7ce3b0bca1d1445b9f1a8e11b6a4d5d2c095a8697e9be","blockNumber":"0x1483962","contractAddress":null,"cumulativeGasUsed":"0x2d23d","from":"0x50fe4ae09765962dd7d9af89e640277e34bc1743","gasUsed":"0x2d23d","logs":[{"address":"0x822764f7780df2e361640c1f0a5ee44b9e669f18","blockHash":"0x5a90b313806798406ac7ce3b0bca1d1445b9f1a8e11b6a4d5d2c095a8697e9be","blockNumber":"0x1483962","data":"0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cdbb781ac508b19c126646e9aedf1475144c0262","logIndex":"0x0","removed":false,"topics":["0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0"],"transactionHash":"0xed8d1aa27390aafcc68574cef2bbeb8424834020c46da8bd9e5dccc13a5f07d1","transactionIndex":"0x0","transactionLogIndex":"0x0","type":"mined"},{"address":"0x822764f7780df2e361640c1f0a5ee44b9e669f18","blockHash":"0x5a90b313806798406ac7ce3b0bca1d1445b9f1a8e11b6a4d5d2c095a8697e9be","blockNumber":"0x1483962","data":"0x","logIndex":"0x1","removed":false,"topics":["0xe366c1c0452ed8eec96861e9e54141ebff23c9ec89fe27b996b45f5ec3884987","0x0000000000000000000000004456d699fb0b98350a910b912c6fa035148b1b6f"],"transactionHash":"0xed8d1aa27390aafcc68574cef2bbeb8424834020c46da8bd9e5dccc13a5f07d1","transactionIndex":"0x0","transactionLogIndex":"0x1","type":"mined"},{"address":"0x822764f7780df2e361640c1f0a5ee44b9e669f18","blockHash":"0x5a90b313806798406ac7ce3b0bca1d1445b9f1a8e11b6a4d5d2c095a8697e9be","blockNumber":"0x1483962","data":"0x0000000000000000000000000000000000000000000000000000000000000001","logIndex":"0x2","removed":false,"topics":["0x10dbc913050d3180c3b99f7da91fd514af7cbc9c1bb59a0da5d2bc38f0cf395a"],"transactionHash":"0xed8d1aa27390aafcc68574cef2bbeb8424834020c46da8bd9e5dccc13a5f07d1","transactionIndex":"0x0","transactionLogIndex":"0x2","type":"mined"}],"logsBloom":"0x00000000000020000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000400000000000000000000000000000000000000000000400000000000000000000080000000000000000000000000020000000000000000000000000000000000420000000000000000000000010000000000000000000400000000000000000000000000000000000000000000000000000000040000008400000000000000000","root":null,"status":"0x1","to":"0x822764f7780df2e361640c1f0a5ee44b9e669f18","transactionHash":"0xed8d1aa27390aafcc68574cef2bbeb8424834020c46da8bd9e5dccc13a5f07d1","transactionIndex":"0x0"}
initializeValidators ===> 444444

Transferring ownership of ValidatorsProxy

pending txHash 0x4bc20f06e8c419a7cf36cf571bc92ea7c07ede57472334113c0eb378d77c6e34

deploying ForeignAMBridge storage

pending txHash 0xce1279f8dd18ee699967b0855ebf1369c5eefa6580058d9330928019705c6ae2
It was not possible to verify 0x4c118b3ea2371277273b2058f6e8fbc92ed96adb in etherscan
[Foreign] ForeignAMBridge Storage:  0x4c118b3EA2371277273B2058f6e8FBC92eD96ADB

deploying ForeignAMBridge implementation

pending txHash 0x9220268bc8733ea57bbef8f34a87f18abb73f090825bcf4b539cb963119d9b1b
It was not possible to verify 0x2a4094c0aa5f862d769709f5b9f835f6e142243a in etherscan
[Foreign] ForeignAMBridge Implementation:  0x2A4094C0aa5f862d769709f5B9F835f6E142243a

hooking up ForeignAMBridge storage to ForeignAMBridge implementation
pending txHash 0x208cfaf767b3f8655a10e9cebdd381a1d00bc05a46172b30f6e6e4bb611a465a

initializing Foreign Bridge with following parameters:


initializing Foreign Bridge with following parameters:

SOURCE_CHAIN_ID: 42, DESTINATION_CHAIN_ID: 77, Foreign Validators: 0x822764f7780df2E361640C1f0A5Ee44b9e669f18,
  FOREIGN_MAX_AMOUNT_PER_TX (gas limit per call): 750000000000000000000000,
  FOREIGN_GAS_PRICE: 10000000000, FOREIGN_REQUIRED_BLOCK_CONFIRMATIONS : 8
  
pending txHash 0xe73de3650ded1b430cb7c437dcfd8c372295acb33f35e9d23d1092bd19cbcdce
transferring proxy ownership to multisig for Foreign bridge Proxy contract
pending txHash 0x4d9b540ff570e0a9ee1d7ed02e19099c1ed10e672e04d27b019c62e77fe174bb

Deployment of Arbitrary Message Bridge at Foreign completed


Deployment has been completed.


[   Home  ] HomeBridge: 0x475A7C9B943F278A1b45287d600D39A186c19698 at block 17281132
[ Foreign ] ForeignBridge: 0x4c118b3EA2371277273B2058f6e8FBC92eD96ADB at block 21510501
Contracts Deployment have been saved to `bridgeDeploymentResults.json`